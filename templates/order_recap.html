{% extends "base.html" %}

{% block title %}Order recap{% endblock %}


{% block content %}
<div class="container">
	<div class="panel panel-default">
		<div class="panel-heading">
			<h1 class="panel-title">Etape 2 : Validation de la commande</h1>
		</div>
	<div class="panel-body">
		<div class="container-fluid">
			<div class="col-md-6">
				<strong>Identifiants de la commande</strong>
				<ul class="list-group">
					<li class="list-group-item"><b>Date : </b>{{ days[order.order_date|date("N")] }} {{ order.order_date|date('d') }} {{ months[order.order_date|date('n')] }} {{ order.order_date|date('Y') }}</li>
					<li class="list-group-item"><b>Référence : </b>{{order.ref}}</li>
					<li class="list-group-item"><b>A livrer le : </b> {{ days[order.delivery_date|date("N")] }} {{ order.delivery_date|date('d') }} {{ months[order.delivery_date|date('n')] }} {{ order.delivery_date|date('Y') }}</li>
				</ul>
			</div>
			<div class="col-md-6">
				<strong>Paramêtres de livraison</strong>
					<ul class="list-group">
						<li class="list-group-item"><span class="glyphicon glyphicon-user"></span> {{ session['user'].name }} {{ session['user'].lastname }}</li>
						<li class="list-group-item"><b><span class="glyphicon glyphicon-envelope"></span></b> {{order.delivery_address}}, {{ order.delivery_zip }} {{order.delivery_town}}</li>
						<li class="list-group-item"><b><span class="glyphicon glyphicon-comment"></span></b> {{ order.delivery_instructions }}
						</li>
					</ul>
			</div>
		</div>
	</div>
	<table class="table table-striped">
		<tr>
			<th>Produit</th>
			<th>Prix unitaire</th>
			<th>Quantité</th>
			<th>Total</th>
		</tr>
		{% for line in session['basket'] %}
		<tr>
			<td>{{line.product.label}}</td>
			<td>{{line.product.price}} €</td>
			<td>{{line.amount}}</td>
			<td>{{ line.value }} €</td>
		</tr>
		{% endfor %}
		{% if order.total_amount - session['basket_amount'] == 20 %}
		<tr>
			<td> Adhésion</td>
			<td> 20 €</td>
			<td> 1 </td>
			<td> 20 € </td>
		</tr>
		{% endif %}
		<tr>
			<th colspan="3"><i>Frais de livraison</i></th>
			<th colspan="1"><i>{% if order.delivery_cost == 5 %} 5 € {% else %} Gratuits {% endif %}</i></th>
		</tr>
		
		<tr>
			<th colspan="3">Total à payer</th>
			<th colspan="1">{{ order.total_amount }} €</th>
		</tr>
	</table>
	<div class="panel-footer text-right">
		<a href="javascript: submitCancel()"><button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button></a>
        <a href="javascript: submitConfirm()"><button type="button" class="btn btn-primary">Confirmer ma commande</button></a>
		<form id="formConfirm" method="POST" action="{{ base_path }}/order/confirm" style="display:none">
			<input type="hidden" name="ref" value="{{ order.ref }}"/>
		</form>
		<form id="formCancel" method="POST" action="{{ base_path }}/order/cancel" style="display:none">
			<input type="hidden" name="ref" value="{{ order.ref }}"/>
		</form>
	</div>
</div>
<script>
function submitCancel() {
  document.getElementById("formCancel").submit();
}
function submitConfirm(){
	document.getElementById("formConfirm").submit();
}
</script>
{% endblock %}